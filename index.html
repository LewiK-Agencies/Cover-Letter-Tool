<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Cover Letter Generator - Daily Jobs</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; }
        .progress-bar { transition: width 0.5s ease-in-out; }
        .input-field { transition: border-color 0.3s ease, box-shadow 0.3s ease; }
        .input-field:focus { border-color: #00A651; box-shadow: 0 0 0 3px rgba(0, 166, 81, 0.1); }
        .add-btn { transition: color 0.3s ease; }
        .add-btn:hover { color: #008c44; }
        .delete-btn { transition: background-color 0.3s ease; }
        .delete-btn:hover { background-color: #ef4444; }
        .menu-hover:hover { background-color: #f3f4f6; border-radius: 4px; }
    </style>
</head>
<body class="bg-gray-100">
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <a href="index.html" class="text-2xl font-bold text-gray-800 flex items-center">
                <span class="text-green-600">Daily</span><span class="text-blue-600">Jobs</span>
            </a>
            <div class="space-x-6 flex items-center">
                <a href="cover-letter-generator.html" class="menu-hover text-gray-700 font-semibold px-3 py-2 hover:text-green-600 transition duration-200">Application Letter</a>
                <a href="ats-checker.html" class="menu-hover text-gray-700 font-semibold px-3 py-2 hover:text-green-600 transition duration-200">ATS Checker</a>
                <a href="https://dailyjobs.co.ke/" class="menu-hover text-gray-700 font-semibold px-3 py-2 hover:text-green-600 transition duration-200">Explore Jobs</a>
                <button id="mobileMenuBtn" class="lg:hidden text-gray-700 focus:outline-none">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"/>
                    </svg>
                </button>
            </div>
        </div>
        <div id="mobileMenu" class="lg:hidden bg-white shadow-md px-4 py-2 space-y-2 hidden">
            <a href="cover-letter-generator.html" class="block text-gray-700 font-semibold hover:text-green-600">Application Letter</a>
            <a href="ats-checker.html" class="block text-gray-700 font-semibold hover:text-green-600">ATS Checker</a>
            <a href="https://dailyjobs.co.ke/" class="block text-gray-700 font-semibold hover:text-green-600">Explore Jobs</a>
        </div>
    </nav>

    <section class="py-12">
        <div class="container mx-auto px-4">
            <h1 class="text-4xl font-bold text-center text-gray-800 mb-8" data-aos="fade-up">Craft Your Perfect Cover Letter</h1>

            <div class="w-full bg-gray-200 rounded-full h-2.5 mb-8" data-aos="fade-up">
                <div id="progressBar" class="progress-bar bg-green-600 h-2.5 rounded-full" style="width: 0%"></div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-lg shadow-lg" data-aos="fade-right">
                    <form id="coverLetterForm" class="space-y-6">
                        <div>
                            <label for="fullName" class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                            <input type="text" id="fullName" class="input-field block w-full p-3 border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-green-500 sm:text-sm" placeholder="e.g., John Doe" required>
                        </div>
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                            <input type="email" id="email" class="input-field block w-full p-3 border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-green-500 sm:text-sm" placeholder="e.g., john.doe@email.com" required>
                        </div>
                        <div>
                            <label for="phone" class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                            <input type="tel" id="phone" class="input-field block w-full p-3 border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-green-500 sm:text-sm" placeholder="e.g., 0712345678" pattern="^07\d{8}$" required>
                        </div>
                        <div>
                            <label for="county" class="block text-sm font-medium text-gray-700 mb-2">County of Residence</label>
                            <input type="text" id="county" class="input-field block w-full p-3 border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-green-500 sm:text-sm" placeholder="e.g., Nairobi" required>
                        </div>
                        <div>
                            <label for="jobTitle" class="block text-sm font-medium text-gray-700 mb-2">Advertised Job Title</label>
                            <input type="text" id="jobTitle" class="input-field block w-full p-3 border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-green-500 sm:text-sm" placeholder="e.g., Software Engineer" required>
                        </div>
                        <div>
                            <label for="companyName" class="block text-sm font-medium text-gray-700 mb-2">Company Name</label>
                            <input type="text" id="companyName" class="input-field block w-full p-3 border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-green-500 sm:text-sm" placeholder="e.g., Tech Innovations Ltd" required>
                        </div>
                        <div>
                            <label for="applicationAddress" class="block text-sm font-medium text-gray-700 mb-2">Application Address (Optional)</label>
                            <input type="text" id="applicationAddress" class="input-field block w-full p-3 border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-green-500 sm:text-sm" placeholder="e.g., The HR Manager">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Work Experience</label>
                            <div id="workExperienceContainer" class="space-y-4">
                                <div class="work-experience-entry flex items-center space-x-3">
                                    <input type="text" class="input-field block w-full p-3 border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-green-500 sm:text-sm" placeholder="e.g., Software Developer at ABC Corp" data-type="company" required>
                                    <button type="button" class="delete-btn bg-red-500 text-white px-3 py-1.5 rounded text-sm hover:bg-red-600">Delete</button>
                                </div>
                            </div>
                            <button type="button" id="addWorkExperience" class="add-btn text-green-600 mt-4 text-sm font-medium hover:underline">+ Add Work Experience</button>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Education Background</label>
                            <div id="educationContainer" class="space-y-4">
                                <div class="education-entry flex items-center space-x-3">
                                    <input type="text" class="input-field block w-full p-3 border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-green-500 sm:text-sm" placeholder="e.g., B.Sc. Computer Science at University of Nairobi" data-type="school" required>
                                    <button type="button" class="delete-btn bg-red-500 text-white px-3 py-1.5 rounded text-sm hover:bg-red-600">Delete</button>
                                </div>
                            </div>
                            <button type="button" id="addEducation" class="add-btn text-green-600 mt-4 text-sm font-medium hover:underline">+ Add Education</button>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Skills/Competence</label>
                            <div id="skillsContainer" class="space-y-4">
                                <div class="skill-entry flex items-center space-x-3">
                                    <input type="text" class="input-field block w-full p-3 border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-green-500 sm:text-sm" placeholder="e.g., JavaScript, Project Management" required>
                                    <button type="button" class="delete-btn bg-red-500 text-white px-3 py-1.5 rounded text-sm hover:bg-red-600">Delete</button>
                                </div>
                            </div>
                            <button type="button" id="addSkill" class="add-btn text-green-600 mt-4 text-sm font-medium hover:underline">+ Add Skill</button>
                        </div>
                        <button type="submit" class="w-full bg-green-600 text-white p-3 rounded-lg shadow-md hover:bg-green-700 text-sm sm:text-base transition duration-200">Generate Preview</button>
                    </form>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-lg hidden" data-aos="fade-left">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Cover Letter Preview</h2>
                    <div id="preview" class="border border-gray-200 p-4 rounded-lg h-96 overflow-y-auto text-gray-700 bg-gray-50"></div>
                    <div id="paymentSection" class="payment-banner text-white p-6 rounded-lg mt-6 text-center hidden">
                        <p class="mb-4 text-lg">Pay Ksh 36 via M-PESA to unlock and download your personalized cover letter in PDF format.</p>
                        <button id="payNowBtn" class="bg-white text-green-600 font-semibold py-2 px-6 rounded-lg shadow-md hover:bg-gray-100 transition duration-200">Pay Now</button>
                        <p id="paymentError" class="text-red-300 mt-2 hidden">Payment failed. Please try again.</p>
                    </div>
                    <button id="editBtn" class="w-full bg-gray-600 text-white p-3 rounded-lg shadow-md mt-4 hover:bg-gray-700 text-sm sm:text-base transition duration-200">Edit Information</button>
                    <a href="cover_letter_download (3).html" id="downloadBtn" class="w-full bg-blue-600 text-white p-3 rounded-lg shadow-md mt-4 hover:bg-blue-700 text-sm sm:text-base transition duration-200 hidden">Download Cover Letter</a>
                </div>
            </div>
        </div>
    </section>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
    <script>
        AOS.init({ duration: 1000 });

        const form = document.getElementById('coverLetterForm');
        const previewDiv = document.getElementById('preview');
        const paymentSection = document.getElementById('paymentSection');
        const editBtn = document.getElementById('editBtn');
        const progressBar = document.getElementById('progressBar');
        const payNowBtn = document.getElementById('payNowBtn');
        const paymentError = document.getElementById('paymentError');
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mobileMenu = document.getElementById('mobileMenu');
        const downloadBtn = document.getElementById('downloadBtn');

        const addWorkExperienceBtn = document.getElementById('addWorkExperience');
        const workExperienceContainer = document.getElementById('workExperienceContainer');
        const addEducationBtn = document.getElementById('addEducation');
        const educationContainer = document.getElementById('educationContainer');
        const addSkillBtn = document.getElementById('addSkill');
        const skillsContainer = document.getElementById('skillsContainer');

        let progress = 0;
        const totalFields = 8;

        const addEntry = (container, placeholder, dataType) => {
            const entry = document.createElement('div');
            entry.className = `flex items-center space-x-3 ${dataType === 'company' ? 'work-experience-entry' : dataType === 'school' ? 'education-entry' : 'skill-entry'}`;
            entry.innerHTML = `
                <input type="text" class="input-field block w-full p-3 border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-green-500 sm:text-sm" placeholder="${placeholder}" data-type="${dataType}" required>
                <button type="button" class="delete-btn bg-red-500 text-white px-3 py-1.5 rounded text-sm hover:bg-red-600">Delete</button>
            `;
            container.appendChild(entry);
            entry.querySelector('.delete-btn').addEventListener('click', () => {
                container.removeChild(entry);
                updateProgress();
            });
            updateProgress();
        };

        addWorkExperienceBtn.addEventListener('click', () => addEntry(workExperienceContainer, 'e.g., Software Developer at ABC Corp', 'company'));
        addEducationBtn.addEventListener('click', () => addEntry(educationContainer, 'e.g., B.Sc. Computer Science at University of Nairobi', 'school'));
        addSkillBtn.addEventListener('click', () => addEntry(skillsContainer, 'e.g., JavaScript, Project Management', 'skill'));

        const updateProgress = () => {
            progress = 0;
            const fields = ['fullName', 'email', 'phone', 'county', 'jobTitle', 'companyName'];
            fields.forEach(id => {
                if (document.getElementById(id).value.trim()) progress++;
            });
            if (workExperienceContainer.children.length > 0) progress++;
            if (educationContainer.children.length > 0) progress++;
            if (skillsContainer.children.length > 0) progress++;
            progressBar.style.width = `${(progress / totalFields) * 100}%`;
        };

        async function generateCoverLetter() {
            const tempData = {
                full_name: document.getElementById('fullName').value,
                email: document.getElementById('email').value,
                phone_number: document.getElementById('phone').value,
                county: document.getElementById('county').value,
                advertised_job: document.getElementById('jobTitle').value,
                company_name: document.getElementById('companyName').value
            };

            const workExperience = Array.from(workExperienceContainer.children).map(child => ({
                job_title: child.querySelector('input').value.split(' at ')[0] || child.querySelector('input').value,
                company_name: child.querySelector('input').value.split(' at ')[1] || ''
            }));
            const education = Array.from(educationContainer.children).map(child => ({
                degree: child.querySelector('input').value.split(' at ')[0] || child.querySelector('input').value,
                school: child.querySelector('input').value.split(' at ')[1] || ''
            }));
            const skills = Array.from(skillsContainer.children).map(child => child.querySelector('input').value);

            const response = await fetch('https://cover-letter-server.onrender.com/generate-cover-letter', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    full_name: tempData.full_name,
                    email: tempData.email,
                    phone_number: tempData.phone_number,
                    county: tempData.county,
                    advertised_job: tempData.advertised_job,
                    company_name: tempData.company_name,
                    work_experience: workExperience,
                    education: education,
                    skills: skills
                })
            });

            const result = await response.json();
            if (result.success) {
                return result.letter;
            } else {
                alert('Error generating cover letter');
                return 'Error generating cover letter. Please try again or contact support.';
            }
        }

        form.addEventListener('input', updateProgress);
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const coverLetterContent = await generateCoverLetter();
            previewDiv.innerHTML = coverLetterContent.replace(/\n/g, '<br>');
            previewDiv.closest('div').classList.remove('hidden');
            paymentSection.classList.remove('hidden');
            downloadBtn.classList.remove('hidden');
            localStorage.setItem('coverLetterData', JSON.stringify({ cover_letter: coverLetterContent }));
        });

        editBtn.addEventListener('click', () => {
            form.scrollIntoView({ behavior: 'smooth' });
        });

        payNowBtn.addEventListener('click', () => {
            window.location.href = 'https://short.payhero.co.ke/s/8a4CrCW8yaSWo62r48uHWx';
        });

        mobileMenuBtn.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });
    </script>
</body>
</html>
